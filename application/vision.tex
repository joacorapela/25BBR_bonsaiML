% Bonsai

\href{https://bonsai-rx.org/}{Bonsai} is a free and open-source visual reactive
programming language widely used for experimental control in neuroscience.
Designed for performance, flexibility, and ease of use, Bonsai enables
scientists with little or no programming background to build high-performance
data acquisition and control systems. With more than 7,000 downloads annually,
nearly 100 citations per year of the core paper, and over 1,000 new users in
2024 alone, Bonsai has become the most widely adopted software platform in
systems neuroscience. Its success demonstrates the transformative role that
sustainable, community-driven research software can play in accelerating
discovery.

% Bonsai.ML
% BBSRC grant

A central priority of UKRI is the application of
\href{https://www.ukri.org/what-we-do/browse-our-areas-of-investment-and-support/artificial-intelligence-in-bioscience/}{artificial
intelligence in bioscience}. In 2022 we recognised that integrating machine
learning (ML) into Bonsai could be transformative for experimental
neuroscience. With BBSRC support
(\href{https://gow.bbsrc.ukri.org/grants/AwardDetails.aspx?FundingReference=BB\%2FW019132\%2F1}{BB/W019132/1}),
we developed Bonsai.ML, which extends Bonsai with state-of-the-art ML methods.
These include
\href{https://bonsai-rx.org/machinelearning/examples/examples/LinearDynamicalSystems/README.html}{Linear
Dynamical Systems},
\href{https://bonsai-rx.org/machinelearning/examples/examples/HiddenMarkovModels/README.html}{Hidden
Markov Models},
\href{https://bonsai-rx.org/machinelearning/examples/examples/Torch/NeuralNetsTrainedOnline/README.html}{Deep
Neural Networks}, and a
\href{https://bonsai-rx.org/machinelearning/examples/examples/PointProcessDecoder/DecodePositionFromHippocampusSortedUnits/README.html}{Point-Process
Decoder}. Embedding these models directly in Bonsai's reactive programming
environment enables adaptive, data-driven experimental designs that were
previously out of reach for many laboratories.

% Challenges

However, adding even the best ML methods to Bonsai.ML is not enough to guarantee
their uptake, since most Bonsai users have little or no training in ML, and
cannot immediately appreciate how these methods can aid their experimentation.
%
% This challenge is not unique to Bonsai.ML, but is common to all software
% seeking to provide ML functionality to non-ML-specialists.
%
% If successful, our proposed solution will serve as a role model to all these
% software.

% Solutions
We will accelerate the uptake and impact of Bonsai.ML through two complementary
strategies.
%
First, we will substantially revamp Bonsai.ML's documentation and strengthen
the current training and dissemination activities. This will empower
experimental neuroscientists to explore and identify ``killer applications'' of
Bonsai.ML to neuroscience independently.
%
Second, we will work hand-in-hand with experimental neuroscientists to address
challenging neuroscience problems with Bonsai.ML, and together demonstrate
transformative applications of Bonsai.ML to neuroscience experimental control.

%
% By reading or watching use cases of applications of Bonsai.ML methods in
% intelligent experimental control, experimental neuroscientists could realise
% the utility of these methods for their own experiments and adopt Bonsai.ML.

These collaboration will mostly use machine learning methods already integrated
into Bonsai.ML, but some of them will require new methods that we will add to
Bonsai.ML and expand its functionality.

\subsubsection{Collaborations}

Collaborations with experimental groups are essential for the creation of
machine learning methods targeted to biological applications. These
collaborations benefit both the experimental and the methods development
partners.
%
The former partner benefits from the machine learning expertise to interrogate its experimental data.
%
The latter partner benefits from state-of-the-art experimental
data, and from biological expertise on the significance and potential of applications of
the machine learning method in biological problems.
%
These collaborations are essential to maximise the impact of
\href{https://www.ukri.org/what-we-do/browse-our-areas-of-investment-and-support/artificial-intelligence-in-bioscience/}{artificial
intelligence in bioscience}.

During the creation of Bonsai.ML, we attempted a few collaborations with
experimental neuroscience groups as, from our experience disseminating Bonsai,
we learned that collaborations are essential to maximize uptake of software for
neuroscientists.
%
In some cases we obtained promising initial results, but achieving the full
goals of the collaboration required further developments, that we did not have
time to pursue.
%
In other collaborations, initial results were not satisfactory, but we could
not dedicate further time to understand the problems that yielded poor
performance, since we were focused on integrating machine learning
functionality into Bonsai.ML.

Now that Bonsai.ML has been created and that it contains core real-time machine
learning methods, we will focus on developing collaborations with experimental
neuroscience groups, use methods already integrated into Bonsai.ML, or develop
new ones, to jointly tackle their intelligent experimental control problems,
and use the results of these collaborations to create a detailed user guides
demonstrating the use of Bonsai.ML to solve state-of-the-art intelligent
experimental control problems.

% We will collaborate with experimental neuroscientists in using Bonsai.ML
% methods to address together some of their challenging problems in intelligent
% experimental control.
%
These collaborations will last between four and eight months, and are designed
to allow sufficient time to customise and optimise the Bonsai.ML methods for the
unique needs of the experimental collaborators, build new Bonsai.ML methods when
needed, and write high-quality use cases documenting outputs of the
collaborations.

The focus of these collaborations will be on the \emph{application} of
Bonsai.ML methods, and not on scientific research.
%
We have selected collaborations where Bonsai.ML methods can have a direct impact,
without requiring much scientific research, and where the impact can be clearly
demonstrated.

Outputs of these collaborations will be described in detailed uses cases in
Bonsai.ML's documentation.
%
In addition, when applications of Bonsai.ML's methods lead to new scientific
discoveries, details of these applications will be presented in research
publications.
%
However, even if a collaboration does not yield a new finding, the Bonsai.ML
use case will still be created, as it will describe in detail the application
of a Bonsai.ML method to a state-of-the-art neuroscience problem, and should
motivate Bonsai users to apply the method to related scientific problems.

Below we summarise the collaboration we will develop, which are detailed in the
Section~\ref{sec:approach} below.

\subsubsubsection*{Collaboration~1: real-time neural latents visualisation for
high-channel-count electrophysiology recordings with
linear dynamical systems}

\begin{description}

    \item[Collaborator:] Dr.~Josh Siegle, senior scientist, Allen Institute for
Neural Dynamics, US.

    \item[Summary:]

        Visualisation is central to scientific inquiry, especially in
        neuroscience. Yet, modern high-density recordings from hundreds or
        thousands of electrodes pose major challenges for clear, real-time
        visualisation. At the Gatsby Unit, we pioneered single-trial
        dimensionality reduction with latent-variable models~\citep{yuEtAl09},
        and extended these approaches in later work
        \citep[e.g.,][]{dunckerAndSahani18}, supported by open-source software
        (\href{https://github.com/joacorapela/svGPFA}{svGPFA}).  However, all
        current latent-variable methods operate offline, after data collection.
        In this project we will integrate state-space models into Bonsai.ML, to
        estimate and visualise latent variables online, during
        high-channel-count recordings.

    \item[Methods:] Gaussian linear dynamical system (already integrated),
Poisson linear dynamical system (to be integrated).

\end{description}

\subsubsubsection*{Collaboration~2: real-time forecasting animal behavior for
zero-lag stimulus presentation in augmented-reality small-animal experiments.}

\begin{itemize}

    \item\textbf{Collaborator:} Prof.~Aman Saleem,
        \href{https://www.saleemlab.com/}{Saleem Lab}, University College London,
        UK.

    \item\textbf{Summary:} In augmented reality experiments, particularly in
        neuroscience, precise stimulus timing is critical, yet unavoidable
        system delays mean that visual stimuli often appear slightly later than
        intended. This latency is especially problematic when linking neural
        activity to sensory input or behavior. To address this, we will use
        algorithms that forecast animal position and head orientation, allowing
        stimuli to be pre-rendered and displayed in synchrony with the
        subjectâ€™s actual position and head orientation.

    \item\textbf{Methods:} Gaussian linear dynamical system (already integrated),
deep learning forecasters (to be integrated).

\end{itemize}

\subsubsubsection*{Collaboration~3: real-time decoding of position from neural
spikes.}

\begin{itemize}

    \item\textbf{Collaborator:} Prof.~John O'Keefe and Prof.~Marcus Stephenson
        Jones, Sainsbury Wellcome Center, University College London, UK.

    \item\textbf{Summary:} We have already integrated into Bonsai.ML a fast
        implementation of a clusterless point-process decoder~\citep[i.e., a
        decoder that does not require spike sorting and is suitable for
        real-time usage;][]{denovellisEtAl21}. However, the current
        implementation of this decoder cannot decode unsorted spikes from
        Neuropixels probes.
        %
        This is a sever limitation, since Neuropixels are becoming the standard
        for high-channel-count electrophysiological recordings.
        %
        We will extend our implementation of the decoder to operate on
        Neuropixels recordings, and demonstrate this extension decoding rat
        positions from hippocampal spikes in a honeycomb
        maze~\citep{woodEtAl18}, and mice positions from striatal spikes in a
        sequence learning task~\citep{thompsonEtAl24}.

        Our collaborator require decoding latencies of less than ten
        milliseconds for their experiments. We will compare the performance of
        the clusterless point-process decoder with that of the same decoder
        using sorted spikes.
        %
        Spike sorting will be performed with a real-time spike sorter that we
        will develop as part of this project.

    \item\textbf{Methods:} Clusterless point-process decoder of animal position
        from spiking activity recorded with tetrodes recordings (already
        integrated); real-time clusterless point-process decoder of animal
        position from spiking activity recorded with Neuropixels probes
        (extension to Neuropixels to be developed; real-time performance
        optimisations to be developed); real-time spike sorter (to be
        developed).

\end{itemize}

\subsubsection{New Bonsai.ML methods}

As part of collaboration~1, we will integrate into Bonsai.ML the \textbf{Poisson
linear dynamical systems} model, which infers latents assuming that spike
counts follow a Poisson distribution. This distribution is better for spike
count than the Gaussian distribution used in the Gaussian linear dynamical
system model already integrated into Bonsai.ML

For collaboration~2, we will evaluate, and possibly integrate into Bonsai.ML,
\textbf{deep learning forecasters}, as these forecasters are able to generate
superior long-horizon predictions than forecasters based on linear dynamical
models.

As part of collaboration 3, we will develop a \textbf{clusterless version of
the point-process decoder able to process recordings from Neuropixels probes}.
%
We will also develop a \textbf{real-time spike sorter for Neuropixels probes}.
%
It will allow us to compare the performance of the point process decoder with
clusterless and sorted spikes..
%
In addition, a real-time spike sorter will allow us to characterize and
manipulate in real time neural processes at the single cell level, like cell
tuning, phase precession, head direction or firing rate adaptation.
